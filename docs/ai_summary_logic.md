# AI Summarization & Classification Logic

This document explains how TidyMail uses AI to summarize and categorize emails.

---

## 1. AI Library/API Used
- **Summarization & Extraction:** Gemini API (Google)
- **Classification:** Gemini API (Google)
- Easily swappable for OpenAI or other LLMs

---

## 2. Summarization Logic
- For each new email, the backend sends the email body to Gemini API with a prompt:

**Prompt Example:**
```
Summarize the following text into 5 key bullet points.
Focus on the most important information and main points.
Keep each bullet point concise and clear.

Text:
<email body>

Return only the bullet points, one per line, starting with '- '.
```

- The API response is parsed into a list of bullet points.
- If the API fails or returns an error, a fallback summary is generated by extracting the first 1-2 meaningful sentences or truncating the text.

---

## 3. Classification Logic
- The backend sends the email subject and body to Gemini API with a prompt:

**Prompt Example:**
```
You are an email classifier. Your task is to carefully analyze the email content and categorize it into exactly one of these categories:

- Internship
- Job Offer
- Funding
- Product Review
- Newsletter
- Event Invitation
- Meeting Request
- Research Article Request
- Spam / Promotion
- General Inquiry
- Security Alert (for account security notifications, login alerts, password changes, etc.)

Important Instructions:
1. Read the ENTIRE email body thoroughly - do not rely solely on the subject line
2. Subjects can be misleading - always verify the actual content in the body
3. Look for key details in the body that indicate the true purpose of the email
4. Consider the context and tone of the entire message
5. If the email could fit multiple categories, choose the most specific one
6. Pay special attention to security-related emails (login alerts, password changes, etc.)
7. Return ONLY the category name, nothing else

Email Subject:
<subject>

Email Body:
<body>

Category:
```
- The API response is parsed as the category string.
- If the API fails or returns an error, the email is marked as unclassified or retried.

---

## 4. Fallback & Retry Logic
- If Gemini API is unavailable or returns an error:
  - For summaries: Use the first 1-2 meaningful sentences or truncate the body.
  - For classification: Mark as error or retry later.
- All errors are logged for review.

---

## 5. Example API Call (Summarization)
```python
response = requests.post(
    settings.GEMINI_API_URL,
    headers={
        "Content-Type": "application/json",
        "x-goog-api-key": settings.GEMINI_API_KEY
    },
    json={
        "contents": [{
            "parts": [{"text": prompt}]
        }]
    }
)
```

---

## 6. Customization
- You can swap Gemini for OpenAI by changing the API endpoint and prompt format.
- Prompts can be tuned for more/less detail, different languages, or other output formats. 